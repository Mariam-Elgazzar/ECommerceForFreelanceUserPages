<div class="product-detail-container">
  <!-- Loading State -->
  <div
    *ngIf="!loading"
    class="loading-state"
    role="status"
    aria-label="جاري التحميل"
  >
    <div class="loading-content">
      <div class="spinner"></div>
      <p class="loading-text">جاري تحميل تفاصيل المنتج...</p>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="!loading && error" class="error-state">
    <div class="error-content">
      <div class="error-icon">⚠️</div>
      <h2 class="error-title">حدث خطأ</h2>
      <p class="error-message">{{ error }}</p>
      <button class="retry-button" (click)="reloadProduct()" type="button">
        إعادة المحاولة
      </button>
    </div>
  </div>

  <!-- Product Content -->
  <div *ngIf="loading && !error && product" class="product-content">
    <!-- Breadcrumb Navigation -->
    <nav class="breadcrumb-nav" aria-label="مسار التنقل">
      <div class="container">
        <ol class="breadcrumb-list">
          <li class="breadcrumb-item">
            <a routerLink="/" class="breadcrumb-link">
              <i class="fas fa-home"></i>
              <span class="breadcrumb-text">الرئيسية</span>
            </a>
          </li>
          <li class="breadcrumb-separator">
            <i class="fas fa-chevron-left"></i>
          </li>
          <li class="breadcrumb-item">
            <a routerLink="/products" class="breadcrumb-link">
              <span class="breadcrumb-text">المنتجات</span>
            </a>
          </li>
          <li class="breadcrumb-separator">
            <i class="fas fa-chevron-left"></i>
          </li>
          <li class="breadcrumb-item breadcrumb-current">
            <span class="breadcrumb-text">{{ product.name }}</span>
          </li>
        </ol>
      </div>
    </nav>

    <div class="container">
      <!-- Product Header -->
      <div class="product-header-section">
        <h1 class="product-main-title">{{ product.name }}</h1>
        <!-- <div class="product-meta-info">
          <span class="product-model"
            >موديل: {{ product.model || product.name }}</span
          >
          <span class="product-category">{{ product.categoryName }}</span>
          <span
            class="product-status"
            [ngClass]="getStatusClass(product.status)"
          >
            {{ getStatusText(product.status) }}
          </span>
        </div> -->
      </div>

      <!-- Main Product Section -->
      <div class="product-main-section">
        <!-- Media Gallery Section -->
        <div class="media-gallery-section">
          <div class="gallery-container">
            <h2 class="section-title">معرض الوسائط</h2>

            <!-- Main Media Display -->
            <div class="main-media-display">
              <div class="media-viewer">
                <div *ngIf="imageLoading" class="media-loading">
                  <div class="spinner small"></div>
                </div>

                <!-- Image Display -->
                <div
                  *ngIf="getCurrentMediaType() === 'image'"
                  class="image-viewer"
                >
                  <img
                    [src]="getCurrentMediaUrl()"
                    [alt]="product.name"
                    class="main-media-image"
                    (click)="openImageZoom(getCurrentMediaUrl())"
                    (load)="onImageLoad()"
                    (error)="onImageError($event)"
                  />
                  <div class="zoom-indicator">
                    <i class="fas fa-search-plus"></i>
                    <span>انقر للتكبير</span>
                  </div>
                </div>

                <!-- Video Display -->
                <div
                  *ngIf="getCurrentMediaType() === 'video'"
                  class="video-viewer"
                >
                  <video
                    [src]="getCurrentMediaUrl()"
                    controls
                    class="main-media-video"
                    preload="metadata"
                  ></video>
                </div>

                <!-- PDF Display -->
                <div *ngIf="getCurrentMediaType() === 'pdf'" class="pdf-viewer">
                  <div class="pdf-preview">
                    <i class="fas fa-file-pdf"></i>
                    <h3>مستند PDF</h3>
                    <p>انقر لفتح المستند</p>
                    <a
                      [href]="getCurrentMediaUrl()"
                      target="_blank"
                      rel="noopener noreferrer"
                      class="pdf-open-btn"
                    >
                      <i class="fas fa-external-link-alt"></i>
                      فتح المستند
                    </a>
                  </div>
                </div>
              </div>
            </div>

            <!-- Media Categories Tabs -->
            <div class="media-tabs">
              <button
                class="media-tab"
                [class.active]="activeMediaTab === 'images'"
                (click)="setActiveMediaTab('images')"
                type="button"
              >
                <i class="fas fa-images"></i>
                <span>الصور ({{ getImages().length + 1 }})</span>
              </button>
              <button
                class="media-tab"
                [class.active]="activeMediaTab === 'videos'"
                (click)="setActiveMediaTab('videos')"
                type="button"
              >
                <i class="fas fa-video"></i>
                <span>الفيديوهات ({{ getVideos().length }})</span>
              </button>
              <button
                class="media-tab"
                [class.active]="activeMediaTab === 'documents'"
                (click)="setActiveMediaTab('documents')"
                type="button"
              >
                <i class="fas fa-file-pdf"></i>
                <span>المستندات ({{ getPdfs().length }})</span>
              </button>
            </div>

            <!-- Media Thumbnails -->
            <div class="media-thumbnails">
              <!-- Images Tab Content -->
              <div *ngIf="activeMediaTab === 'images'" class="thumbnails-grid">
                <!-- Main Product Image -->
                <button
                  *ngIf="product.mainImageURL"
                  (click)="selectMedia(-1)"
                  class="thumbnail-btn image-thumb"
                  [class.active]="selectedMediaIndex === -1"
                  type="button"
                >
                  <img
                    [src]="product.mainImageURL"
                    [alt]="product.name + ' - الصورة الرئيسية'"
                    class="thumbnail-image"
                  />
                  <div class="thumbnail-label">الصورة الرئيسية</div>
                </button>

                <!-- Additional Images -->
                <button
                  *ngFor="let media of getImages(); let i = index"
                  (click)="selectMedia(i)"
                  class="thumbnail-btn image-thumb"
                  [class.active]="
                    selectedMediaIndex === i &&
                    getCurrentMediaType() === 'image'
                  "
                  type="button"
                >
                  <img
                    [src]="media.imageThumbnailURL || media.mediaURL"
                    [alt]="product.name + ' - صورة ' + (i + 1)"
                    class="thumbnail-image"
                  />
                  <div class="thumbnail-label">صورة {{ i + 1 }}</div>
                </button>
              </div>

              <!-- Videos Tab Content -->
              <div *ngIf="activeMediaTab === 'videos'" class="thumbnails-grid">
                <button
                  *ngFor="let media of getVideos(); let i = index"
                  (click)="selectVideoMedia(i)"
                  class="thumbnail-btn video-thumb"
                  [class.active]="
                    selectedMediaIndex === i &&
                    getCurrentMediaType() === 'video'
                  "
                  type="button"
                >
                  <video
                    [src]="media.mediaURL"
                    [poster]="media.imageThumbnailURL"
                    class="thumbnail-video"
                    muted
                    preload="metadata"
                  ></video>
                  <div class="video-overlay">
                    <i class="fas fa-play"></i>
                  </div>
                  <div class="thumbnail-label">فيديو {{ i + 1 }}</div>
                </button>
              </div>

              <!-- Documents Tab Content -->
              <div
                *ngIf="activeMediaTab === 'documents'"
                class="documents-grid"
              >
                <div
                  *ngFor="let media of getPdfs(); let i = index"
                  class="document-item"
                >
                  <div class="document-icon">
                    <i class="fas fa-file-pdf"></i>
                  </div>
                  <div class="document-info">
                    <h4 class="document-title">مستند {{ i + 1 }}</h4>
                    <p class="document-description">دليل المنتج والمواصفات</p>
                    <div class="document-actions">
                      <a
                        [href]="getPdfUrl(media.mediaURL || '')"
                        target="_blank"
                        rel="noopener noreferrer"
                        class="doc-preview-btn"
                        type="button"
                      >
                        <i class="fas fa-eye"></i>
                        معاينة
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Product Information (keep existing) -->
        <div class="product-info-section">
          <div class="info-container">
            <!-- Price Section -->
            <div class="price-section">
              <div class="price-display">
                <h3 class="details-title">تفاصيل المنتج</h3>
              </div>
            </div>

            <!-- Product Details -->
            <div class="product-details-card" *ngIf="product">
              <div class="details-list">
                <div class="detail-item">
                  <i class="fas fa-cube"></i>
                  <div class="detail-content">
                    <span class="detail-label">الموديل</span>
                    <span class="detail-value">{{ product.model }}</span>
                  </div>
                </div>
                <div class="detail-item">
                  <i class="fas fa-palette"></i>
                  <div class="detail-content">
                    <span class="detail-label">البراند</span>
                    <span class="detail-value">{{ product.brand }}</span>
                  </div>
                </div>
                <div class="detail-item">
                  <i class="fas fa-tools"></i>
                  <div class="detail-content">
                    <span class="detail-label">الفئة</span>
                    <span class="detail-value"
                      >{{ product.categoryName }}
                    </span>
                  </div>
                </div>

                <!-- Quantity and Actions -->
                <div class="purchase-section">
                  <div class="action-buttons d-felx flex-column">
                    <button
                      class="btn-primary"
                      type="button"
                      *ngIf="product.status !== 'إيجار'"
                      (click)="confirm(product.id, 'شراء')"
                    >
                      <i class="fas fa-shopping-cart"></i>
                      <span>شراء الآن</span>
                    </button>
                    <button
                      class="btn-secondary"
                      type="button"
                      *ngIf="product.status !== 'شراء'"
                      (click)="confirm(product.id, 'إيجار')"
                    >
                      <i class="fas fa-cart-plus"></i>
                      <span>إيجار الآن</span>
                    </button>
                  </div>

                  <!-- <div class="additional-actions">
                    <button class="btn-link" type="button">
                      <i class="fas fa-share-alt"></i>
                      <span>مشاركة المنتج</span>
                    </button>
                    <button class="btn-link" type="button">
                      <i class="fas fa-heart"></i>
                      <span>إضافة للمفضلة</span>
                    </button>
                  </div> -->
                </div>

                <!-- Features Section -->
                <div
                  class="description-section"
                  dir="rtl"
                  *ngIf="product.additionalAttributes"
                >
                  <h3 class="section-title">المميزات الرئيسية</h3>
                  <div class="description-content">
                    <div class="description-highlights">
                      <ul>
                        <li *ngFor="let attribute of getAdditionalAttributes()">
                          <span class="feature-label"
                            >{{ attribute.key }}:
                          </span>
                          <span class="fs-6">{{ attribute.value }}</span>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
              <!-- 1x -->
            </div>
          </div>
        </div>
        <!-- 2x -->
      </div>
      <!-- Product Description -->
      <div class="description-section description-box" *ngIf="product.description">
        <h2 class="section-title">وصف المنتج</h2>
        <div class="description-content">
          <div class="description-highlights">
            <ul>
              {{
                product.description
              }}
            </ul>
          </div>
        </div>
      </div>

      <!-- Related Products -->
      <section *ngIf="relatedProducts.length > 0" class="related-section">
        <h2 class="section-title">منتجات مشابهة</h2>
        <div class="related-grid">
          <article
            *ngFor="let relatedProduct of relatedProducts"
            class="related-card"
          >
            <div class="related-image-wrapper">
              <img
                [src]="relatedProduct || 'assets/images/default-product.jpg'"
                [alt]="relatedProduct.name"
                class="related-image"
              />
            </div>
            <div class="related-content">
              <h3 class="related-name">{{ relatedProduct.name }}</h3>
              <a
                [routerLink]="['/products', relatedProduct.id]"
                class="related-link"
              >
                عرض التفاصيل
              </a>
            </div>
          </article>
        </div>
      </section>

      <!-- Image Zoom Modal -->
      <div
        *ngIf="showImageZoom"
        class="zoom-overlay"
        (click)="closeImageZoom()"
        role="dialog"
        aria-modal="true"
      >
        <div class="zoom-content" (click)="$event.stopPropagation()">
          <img [src]="zoomedImageUrl" alt="صورة مكبرة" class="zoomed-image" />
          <button (click)="closeImageZoom()" class="zoom-close" type="button">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
