<div class="container-fluid py-4">
  <!-- Page Header -->
  <div class="row mb-4">
    <div class="col-12">
      <h1 class="display-4 text-center mb-4">منتجاتنا</h1>
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a routerLink="/">الرئيسية</a></li>
          <li class="breadcrumb-item active">المنتجات</li>
        </ol>
      </nav>
    </div>
  </div>

  <!-- Filters and Search -->
  <div class="row mb-4">
    <div class="col-md-4 mb-3">
      <label for="categoryFilter" class="form-label">الفئة</label>
      <select
        id="categoryFilter"
        class="form-select"
        [(ngModel)]="selectedCategory"
        (change)="onCategoryChange()">
        <option value="">جميع الفئات</option>
        <option *ngFor="let category of categories" [value]="category">
          {{ category }}
        </option>
      </select>
    </div>

    <div class="col-md-4 mb-3">
      <label for="sortBy" class="form-label">ترتيب حسب</label>
      <select
        id="sortBy"
        class="form-select"
        [(ngModel)]="sortBy"
        (change)="onSortChange()">
        <option value="name">الاسم</option>
        <option value="price-low">السعر: من الأقل للأعلى</option>
        <option value="price-high">السعر: من الأعلى للأقل</option>
      </select>
    </div>

    <div class="col-md-4 mb-3">
      <label for="searchTerm" class="form-label">البحث</label>
      <input
        type="text"
        id="searchTerm"
        class="form-control"
        placeholder="ابحث عن المنتجات..."
        [(ngModel)]="searchTerm"
        (input)="onSearchChange()">
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-warning" role="status">
      <span class="visually-hidden">جاري التحميل...</span>
    </div>
  </div>

  <!-- Products Grid -->
  <div *ngIf="!loading" class="row">
    <div class="col-lg-3 col-md-4 col-sm-6 mb-4" *ngFor="let product of paginatedProducts">
      <div class="card h-100 product-card">
        <img [src]="product.image" alt="{{product.name}}" class="card-img-top">
        <div class="card-body d-flex flex-column">
          <h5 class="card-title">{{ product.nameAr }}</h5>
          <p class="card-text text-muted small flex-grow-1">{{ product.descriptionAr }}</p>
          <div class="mt-auto">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <span class="h5 text-warning mb-0">{{ product.price | currency:'SAR ':'symbol':'1.2-2' }}</span>
              <small class="text-muted">{{ product.category }}</small>
            </div>
            <div class="d-grid gap-2">
              <button
                class="btn btn-warning"
                (click)="addToCart(product)">
                إضافة للسلة
              </button>
              <a
                [routerLink]="['/product', product.id]"
                class="btn btn-outline-secondary btn-sm">
                عرض التفاصيل
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- No Products Found -->
  <div *ngIf="!loading && filteredProducts.length === 0" class="text-center py-5">
    <i class="fas fa-search fa-3x text-muted mb-3"></i>
    <h3>لم يتم العثور على منتجات</h3>
    <p class="text-muted">جرب تغيير معايير البحث أو الفلترة</p>
  </div>

  <!-- Pagination -->
  <nav *ngIf="!loading && totalPages > 1" aria-label="Products pagination">
    <ul class="pagination justify-content-center">
      <li class="page-item" [class.disabled]="currentPage === 1">
        <button class="page-link" (click)="changePage(currentPage - 1)">السابق</button>
      </li>
      <li
        class="page-item"
        *ngFor="let page of [].constructor(totalPages); let i = index"
        [class.active]="currentPage === i + 1">
        <button class="page-link" (click)="changePage(i + 1)">{{ i + 1 }}</button>
      </li>
      <li class="page-item" [class.disabled]="currentPage === totalPages">
        <button class="page-link" (click)="changePage(currentPage + 1)">التالي</button>
      </li>
    </ul>
  </nav>
</div>
